<?php declare(strict_types=1);

use MageHx\MageTemplateUtils\Model\Esc;
use MageHx\MageTemplateUtils\Model\ViewModelProvider;
use MageHx\MahxCheckout\ViewModel\HxAttributesRenderer;
use Magento\Framework\View\Element\Template;
use MageHx\MahxCheckout\ViewModel\GuestEmail;

/** @var Template $block */
/** @var string $nonce */
/** @var Esc $esc */
/** @var string $formKey */
/** @var ViewModelProvider $viewModelProvider */

$viewModel = $viewModelProvider->get(GuestEmail::class);
$hxAttrRenderer = $viewModelProvider->get(HxAttributesRenderer::class);
?>
<div id="guest-email-form-container">
    <form id="guest-email-form" class="form form-login" novalidate="novalidate" x-data="GuestEmailForm">
        <fieldset id="customer-email-fieldset" class="fieldset">
            <div class="field _required form-control w-full max-w-lg">
                <label class="label" for="gef-email">
                    <span class="label-text after:content-['*'] after:text-red-500 after:ml-1">
                        <?= $esc->html(__('Email Address')) ?>
                    </span>
                </label>
                <div class="control">
                    <input
                        id="gef-email" type="text" name="email" placeholder="joe@example.com"
                        class="input-text input input-bordered input-sm md:input-md w-full max-w-lg"
                        value="<?= $esc->htmlAttr($viewModel->getEmail()) ?>"
                        <?= $hxAttrRenderer->hxBuilder()
                            ->post('mahxcheckout/form/guestEmailPost')
                            ->swapNone()
                            ->validate()
                            ->render(); ?>
                    />
                </div>
            </div>
        </fieldset>
        <?= $formKey ?>
    </form>
    <?php if (!$viewModel->isVirtualCart()): ?>
        <div class="max-w-xs my-4 md:my-8">
            <div class="divider"></div>
        </div>
    <?php endif; ?>
    <?= $block->getChildHtml('luma_js') ?>
</div>
